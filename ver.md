## rfriends3のアップデート情報  
  
![rfriendsupdate](https://github.com/user-attachments/assets/47233834-5352-4b09-9308-f88842119cb5)
  
障害報告をお願いします。  
（使用機種、プレミアム会員種別、バージョン、バグ内容）     
  
> [!CAUTION]
> cuiモードでシステム更新をすると、新しいパラメータが出てきません。  
>  [9-1-3] パラメータ設定 - チェック　で更新してください。
  
> [!NOTE]  
> rfriends3のバージョンについては、[バージョン表記について](ver_doc.md)を参照ください。
  
### 1.3.3-alfa04 (2026/02/11)         
  
1.3.2 -> 1.3.3-alfa05  
  
- ffmpeg4.3未満の判定で誤判定になるのを修正しました。  
  4.3未満と判定できない場合は、4.3以上とするよう変更しました。  
  ffmpeg_seekable = 2　に設定すれば強制的に4.3未満判定となります。  
  らじるらじる聞き逃しが録音できている場合は気にする必要はありません。  
     
- 番組配送のradiru_vod,radiru_gogakuがうまくいかない件を修正しました。  
  
- **1.3.2 でradikoのリアルタイム録音が早期終了する件に対応しました。**  
  
- タイムフリーの録音聴取の一覧表示がおかしい件を修正しました。
      
### 1.3.2 (2026/02/01)         
  
1.3.1b -> 1.3.2  
  
- **1/26のradiko timefreeの仕様変更に対応しました。**  
- **NHKらじるらじるの新しいストリーミングサイトに変更しました。**  
     
- いつのまにかレスキュー機能がOFFになっていたのを修正しました。  
- ffmpeg8.0に仮対応しました。(臨時の機能です)  
  8.0だとradikoの録音がすぐに終了してしまうため  
  
- raspberry piのヘッドホン端子に対応しました。  
　管理 - OS別機能 - Linux - audio選択  
　Card:bcm2835  
　Mixer:!plane    
- CUIモードで配信遅れのキーワード編集を追加しました。   
- CUIモードで地域情報更新のバグを修正しました。  
- 録音ディレクトリを変更すると、録音済みデータの再生ができなくなるのを修正しました。  
> [!CAUTION]  
> 録音ディレクトリにスペースを含めるのは避けてください。  
> 未対応個所がある可能性があります。  
  
- ラジコプレミアムでラジオ局をNHKと判断して録音できなくなっていたのを修正しました。  
- update表示エラーを修正しました。  
- ソースの整理      
- キーワード - 配信遅れ  
  ステーション別に配信遅れを設定できるようにしました。  
  あらかじめ当方で計測した値がプリセットしてあります。  
  
もし、結果が違う場合は、ログの下記部分を添付して掲示板に報告してください。  
  
![delay](https://github.com/user-attachments/assets/78b5254f-ec13-49f1-9b33-e70e85bbfa33)
  
### 1.3.1b (2026/01/22)         
    
1.3.0 -> 1.3.1b
  
- PHP8.3より、以下のメッセージが出るのに対処しました。  
  PHP Deprecated:  Increment on non-numeric string is deprecated, use str_increment() instead  
- 長時間のpodcastのダウンロードでtagerrorが発生していました。  
  例：  
  dir  : /home/rpi/smbdir/usr2/podcast/user/安住紳一郎の日曜天国/  
  file : 20260104_2026-1-4「2026年-日曜天国福袋」.mp3  
  file size : 190888 KB    
- radikoの録音時、新streamが配信されていない場合、旧streamに変更。
- 配信遅れ、マージンの調整範囲を60秒から90秒に変更。
- メニュー表示時にエラーメッセージが出るのを修正。   
- trans機能にfolder.jpg作成処理を追加（volumio対策）
- Windows版でWMIがインストールされていない場合、Get-WmiObject(PowerSHell)を使用  
　ただし、遅いため、WMIのインストール推奨
- Windows版を新規インストールすると、php8.5,ffmpeg8.0.1に   
- volumioにrfriends3をインストールして使用しているケースで、  
dacに電子ボリューム機能がない機種(例：FX-audio D302J+ SA9123L)の場合、
rfriends再生で音が出なくなっていました。  
追記）moode playerではうまくいかないようです。  

update後  
設定 - パラメータ - 編集  
audio_type = 0  
で再生できるようになります。  
  
### 1.3.0 (2025/12/11)         
    
1.2.9a -> 1.3.0 
   
- エリアフリーの聴取、録音ができなくなっていたのを修正。  
- radikoのストリーミングurlを変更
- 録音データ再生で音量を変えると最初から再生に戻るバグ修正  
  
### 1.2.9a (2025/12/04)         
    
1.2.8 -> 1.2.9a  
   
- 環境による聴取（サーバ）の音切れに対応。
- alsa設定を変更。(update後、要再設定)  
- 低品質回線対策。            
- らじる聞き逃し、ゴガクの一括録音に関して、最新日の録音ができていませんでした。
  
### 1.2.8 (2025/11/05)       
    
1.2.7 -> 1.2.8  
  
- らじる聞き逃し、ゴガクの一括録音に関して最新日付以外録音できなかった件に対処。
- らじる聞き逃しの一括録音に時間がかかる件に対処。
  
- [Linux] ALSA設定の改良  
  
### 1.2.7 (2025/11/01)     
    
1.2.6 -> 1.2.7  
  
- audeeの検索を修正しました。  
- audeeの検索を番組と、コンテンツに分けました。  
   
- PulseAudio対応  
 管理 - パラメータにpulseaudio追加  
　alsaドライバがない場合（例：bluetooth）、pulseaudio=1  
　ヘッドレスの場合、電源ON時にsshで’pulseaudio --kill’が必要

- onair画面  
  番組選択時に最新に更新するようにしました。
  
- 管理（OS別機能）追加  
   
- podcast画面改良
  
### 1.2.6n (2025/10/25)        
  
1.2.5 -> 1.2.6n
  
- 微修正  
  
- TOP画面でののOpenSSL error:1416F086
- timefree 聴取のOpenSSL error:1416F086  
SSL証明書切れが原因です。  
2025/02頃対策しましたが、 timefree 聴取は最近追加した機能のため対策が漏れていました。
      
- NHKらじるらじるのアクセスに時間がかかっていたのを修正しました。
  
-   NHKらじるの配信アドレスが変更になって、らじるの録音ができなくなっています。  
自動対応のつもりでしたが、ミスがありました。  
次回からは自動で対応すると思います。   
安全策として、update時に配信アドレスを更新するようにしました。  
  
-   ヘッドレスブラウザのチェック方法に誤りがありました。  
Termux版にはヘッドレスブラウザはないのにあると判断していたのを修正しました。    
  
-   ((CUI)timefree検索範囲がtimefree30を契約していないのに30日間になっていました。  
８日前以前の番組は検索されるが、録音はできない状態でした。  
検索範囲を7日前に修正しました。  
GUIは問題ありません。  
  
-   ((CUI)update時に以下のようなメッセージが出ていたのを修正しました。  
  'upfl' is not recognized as an internal or external command,  
operable program or batch file.   
なお、update 自体は正常に終了しています。  
  
-   (CUI)タイムフリー - 録音・聴取の放送済み番組一覧を昇順に  
修正によりエラーになっていたのを修正しました。  
  
-   ニッポン放送ポッドキャストのジャンルにスポーツ、未分類を追加
-   ラジコ、らじるの放送中に'聴取'、'聴取（サーバ）'を復活
-   (CUI)タイムフリー - 録音・聴取の放送済み番組一覧を昇順に
-   back(戻る)を削除（ブラウザの標準機能 ← を使用してください）   
-   アイコンにテキストおよび代替テキストを追加。  
  ホーム、Webdav、聴取アイコンにテキストおよび代替テキストを追加しました。
  
 ![icon](https://github.com/user-attachments/assets/05b82f0c-579c-4bca-9956-f17c38edc9a9)  
  
-   ALSA設定の追加  
Linux版で、聴取（サーバ）で音量設定を追加しました。  
Linux版で、聴取（サーバ）で音を出す設定を追加しました。
  
![ffplay](https://github.com/user-attachments/assets/34169762-cf07-46d1-8d8b-d7fda9d270fb)  
  
-   録音データ関連の修正  
ジャケット表示、音量調整  
  
-   聴取（サーバ）関連の修正  
    音量調整     
  
- update情報を復活  
ただし、前回のアクセスより1時間以上経過している場合のみ更新  
\[安定版,開発版\]  
  Ver. \[upd\]	:	  1.2.6-a14 \[1.2.5 , 1.2.6-a14\]
  
- timefreeの聴取（7日間）ができるようになりました。  
今までは聴取（サーバ）のみでしたが、聴取に対応  

- ラジコプレミアム対応を強化しました。（要プレミアム契約）  
timefree30の過去30日間再生・録音に対応  
ダブルプランでtimefree30の全国番組に対応  
  
- radikoのエリアが変わっっていた場合の対応   
　同一CHがあれば録音、なければメッセージを出して録音しない。  
　(同一CHとは広域圏で県をまたがって同じCH名で放送していること)  
  プレミアム契約者には変更ありません。  
  また、radikoの地域が安定している人には関係ありません。    
  
```  
 認証モード:0 (プレミアム:0  録音エリア:JP40)
 エリアフリー:0 [エリア:JP40  CH:LOVEFM] [ホーム:JP20]
 ------------------------------------------------------------
 ホームエリア(JP20)と録音エリア(JP40)が異なっています。
 20250813_JP20.xml  2025/08/13 20:15:27   342054
 このホームエリア(JP20)にはチャネル(LOVEFM)が存在しません。
 ------------------------------------------------------------
```
  
## 1.2.5 (2025/08/12)     
  
1.2.4 -> 1.2.5  
   
・ ABCR_KOSHIEN対応   
　甲子園特別番組がプレミアムだとエラーになるのを対応  
 ・プレミアム、timefree30の認証対応   
　timefree30の認証に不具合があったのを対応    
    
・聞き逃し、ゴガクの検索を修正  
　らじるのフォーマットが変更になった時から検索が遅くなっていたので修正しました。  
　検索範囲をタイトル内のみとしたので、一部ヒットしなくなりました。  
　予約に関しては従来通りで変更はありません。     
    
・キーワード一覧表示のバグを修正  
    
・プレミアム契約でRN1,RN2,NHK-FMアクセスエラーを修正  
  
・番組配送機能に1年と全期間を追加  
  
・iPhone/iPad(iSH SHell)に対応(cui/gui)  

・iPhone/iPad版用update機能を追加  
iPhone/iPad版では、従来のupdateでかなりの頻度で失敗するため。 
  
・iPhone/iPad版でファイルアプリでの表示を可能にしました。  
  
[9-1-2] パラメータ設定 - 編集　に"auto"設定を設けました。  
通常は変更する必要はありません。  
  
```　　
;　iPhone(iSH Shell版)のとき、
;　ファイルアプリでファイルを参照できるようにする
;
; no  しない
; yes する
; auto 自動設定(iSHの時、自動でyes、以外の時はnoになります)
utf8_mac = "auto"
```  
  
1.2.4-a05 以前は、濁点、半濁点が別文字になっていましたが、  
この版では一文字になりました。  
ウムラウト付き文字も問題ないようです。    
  
  
### 1.2.4 (2025/07/23)   
  
1.2.3 -> 1.2.4    
  

・FM_OKINAWAのタイムフリー表示が異常なのを修正    
_(アンダーバー)は様々な区切りとして使用しており誤動作していました。  
おそらく、このバグはかなり昔から存在。  
  
また、今回の修正に伴い、録音ファイルのチャネル名が  
FM_OKINAWA -> FM-OKINAWA  
なります。   
```
 move
   from : /home/rpi/tmp/20250713_093000_100000_FM_OKINAWA_tf_202507192330390791127.m4a
   to   : /home/rpi/smbdir/usr2/timefree/FM-OKINAWA_EPO-風と海と空と_20250713_0930_1000.m4a
```
    
・alpine linux 向け修正  
alpine linuxでは、glob関数のGLOB_BRACEがないため、エラーが発生していました。  
alpine linuxでは、PSコマンドの仕様が異なるため、各種表示に不具合がありました。  
  
・iPhoneアプリiSH Shell対応（仮）  
  
・ios ブラウザ対応  
iPhoneではプルダウンリストに不具合があるため、複数選択ができないようにしました。  
optgroup指定でもうまくいかないため。  
  
・以下のメニューから聴取および聴取（サーバ）を削除  
ラジコ-放送中  
らじる-放送中  
ラジコ-放送局  
らじる-放送局  
  
トップ画面の機能と重複するため。  
  
・軽微な修正  
  
   
### 1.2.3 (2025/07/13)   
  
1.2.2 -> 1.2.3  
  
・TOP画面よりUPD表示を削除  
表示の高速化を優先したため。 
  
・httpsプロキシ環境での放送中番組の聴取に対応  
  
・css  
https://fonts.googleapis.com/earlyaccess/notosansjp.css  
に変更  　
  
・NHKゴガク  
　ニュースで学ぶ「現代英語」、ラジオビジネス英語のurlが変更になっていたのを修正  
  
・ツール更新  
　メッセージが間違っていたのを修正  
　現在、更新はないため、実行は不要です。    
  
・期間を7日間に（局別の1週間のKW登録のため）  
　ラジコ - 放送局  
　らじる - 放送局   
   
・KW登録機能を追加(複数可)  
　radiko : 放送中、放送局  
　radiru : 放送中、放送局  
  
### 1.2.2 (2025/06/19)   
  
1.2.1 -> 1.2.2  
  
・clearlog処理の修正  
　録音開始時にclearlog処理が走って予約データを消してしまうバグがありました。  
  
 ------- 2025/06/14 15:24:01 : rfriends_rec start  
 Reservation file not found  
  
・top画面を一部変更しました。  
　クリックすると下記の機能にジャンプします。  
  
　ラジコ　-　ラジコ予約一覧  
　らじる　-　らじる予約一覧  
　データ　-　録音データ表示/再生  
　残容量　-　残容量詳細  
　Ver.	　-　バージョン情報  
　upd	　-　システム更新  
  
・メール送信機能の件名を一部変更しました。  
・ラジコサーバの仕様変更に対処  
  
### 1.2.1 (2025/05/27)  
  
1.2.0 -> 1.2.1  
  
・現在放送中の番組表示機能追加  
・放送中、放送局から番組聴取機能追加  
・放送中にKW登録機能追加  
・ラジコ、らじるの番組予約、番組予約リストの統合  
・ラジコ、らじるの番組聴取メニューの削除  
  
