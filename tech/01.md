# RaspberryPi Zeroをラジオにする方法(bluetooth編)  
  
  
　RaspberryPiをラジオにしたいとおもいました。  
今更いろいろ買い足したくはないが、なぜかRaspberryPiとbluetoothスピーカは持ってる人向けです。  

![PXL_20250930_051104218 PORTRAIT~2](https://github.com/user-attachments/assets/d45b1742-20bb-42a3-987d-8702da3b1fe1)


改版 2025/10/01  
  
## ０．はじめに  
  
　以前ダイソーで550円で手に入れたbluetoothスピーカがあることを思い出しやってみました。  
  
必要なもの  
  
・Raspberry Pi (ここではZeroを使用)  
・bluetoothスピーカ  
  
　私は、ダイソーのbluetoothスピーカを使用しました。  
  ![20220501142644](https://github.com/user-attachments/assets/ed777700-d0ec-40f4-92c9-00816f272402)

  
## １．Raspberry Pi  
  
### 1.1 rfriendsのインストールおよび設定を行う。  
  
　以下を参照して、rfriendsをインストールしてください。  
  
[RaspebrryPi版rfriends3でラジオ録音（OSイメージ編）](https://rfriends.github.io/rfriends/distro/raspi_image.html)
  
インストール後、rfriendsのバージョンを最新にしてください。  
  
1.2.7-a01以上。  
  
### 1.2 pulseaudio,bluetoothモジュールのインストール  
  
SSHでRaspberry Pi にアクセスし、以下のコマンドを入力します。  
  
```  
$ sudo apt-get install pulseaudio-module-bluetooth  
...  
The following NEW packages will be installed:  
libasound2-plugins libpulsedsp libspeexdsp1 pulseaudio pulseaudio-module-bluetooth  
pulseaudio-utils rtkit  
...  
```  
  
> [!CAUTION]  
> インストール後は必ず再起動してください。  
  
```  
$ sudo reboot  
```  
  
## ２．ペアリング  
  
RaspberryPiとbluetoothスピーカーをペアリングします。  
  
### 2.1 bluetoothスピーカーの電源を入れペアリング待ち状態にします。  
  
購入時の説明書等でbluetoothスピーカーの機種名を調べておく。私の場合はSR9910でした。  
わからない場合はスマホでbluetoothスキャンするといいと思います。ただしペア設定はしないように。  
  
### 2.2 Raspberry Pi  
  
以下のような流れになります。  
  
SSHでRaspberry Pi にアクセスし、以下のコマンドを入力します。  
```  
・bruetoothctl(起動)  
・scan on (bluetooth機器をスキャンする)  
・scan off (bluetooth機器のスキャンをやめる)  
・pair（見つかった機器とペアリングする）  
・connect（見つかった機器に接続する）  
コネクトに成功すると、bluetoothスピーカー側でピローンといった音が出ます。  
・trust（接続した機器を信頼設定する）  
・paired-devices（ペアリングした機器一覧を表示する）  
・exit(終了)  
```  
  
以下、実行例です。  
  
```  
$ bluetoothctl  
Agent registered  
  
[bluetooth]# scan on  
Discovery started  
.....  
[NEW] Device XX:XX:XX:XX:XX:XX SR9910  
.....  
  
[bluetooth]# scan off  
[CHG] Controller B8:27:EB:F7:D3:93 Discovering: no  
Discovery stopped  
  
[bluetooth]# connect XX:XX:XX:XX:XX:XX  
Attempting to connect to XX:XX:XX:XX:XX:XX  
[CHG] Device XX:XX:XX:XX:XX:XX Connected: yes  
.....  
Connection successful  
  
[bluetooth]# trust XX:XX:XX:XX:XX:XX  
[CHG] Device XX:XX:XX:XX:XX:XX Trusted: yes  
Changing XX:XX:XX:XX:XX:XX trust succeeded  
  
[bluetooth]# paired-devices  
Device XX:XX:XX:XX:XX:XX SR9910  
  
[bluetooth]# exit  
```  
  
> [!CAUTION]  
> もし、以下のようなメッセージが出た場合は、  
> pulseaudio-module-bluetooth  
> のインストールが正常におこなわれていないか  
> または、インストール後に再起動をしていません。  
  
```  
[bluetooth]# connect XX:XX:XX:XX:XX:XX  
Attempting to connect to XX:XX:XX:XX:XX:XX  
Failed to connect: org.bluez.Error.Failed  
```  
  
  
## ３．音声出力テスト  
  
bluetoothスピーカーの電源を入れなおしてください。  
RaspberryPiと接続するとピンポーンという音が鳴ります。（ただし、機種により異なる）  
  
SSHでRaspberry Pi にアクセスし、以下のコマンドを入力します。  
  
```  
$ speaker-test -t wav  
  
speaker-test 1.2.4  
Playback device is default  
```  
  
これで、スピーカより音が出たら成功です。  
出ない場合は設定を見直してください。  
  
  
## ４．rfriendsよりラジオを再生  
  
### 4.1 GUI  
  
Webブラウザでrfriendsにアクセスします。  
  
1)デバイス選択（通常は不要）  
  
管理 - OS別機能 - Linux - audio選択(PulseAudio)  
  
![clip_2](https://github.com/user-attachments/assets/f3c01603-925e-4dda-ad7e-5839d72e31e1)

  
2)ラジオ聴取（onairをクリック）  
  
  ![onair](https://github.com/user-attachments/assets/4045e171-ac26-445a-a395-335d208b9ee7)

  
3) 番組を選択（聴取（サーバ））
  
  ![server](https://github.com/user-attachments/assets/bd004ea2-0b85-4866-ae4c-1ad4f8a364a1)

  
4) 音量調整  
  
音量を調整し（最初は30%くらい）、ミュートボタンを解除する。  

![rani](https://github.com/user-attachments/assets/7c201923-0954-4df3-8947-1d03d02d2a29)

  
### 4.2 CUI  
  
SSHでRaspberry Pi にアクセスします。  
  
1) rfriends3を起動し、[2-9]ラジコ-番組聴取を選択する。  
2) 聞きたい番組を選択。  
これで、スピーカよりラジオの音声が流れるはずです。  
3) 番組を変えるには、別の番組を選択するだけです。  
4) 中止する場合は、[1-2]再生中止を選択してください。  
5) 音量調節は以下のコマンドです。  
  
```  
$ alsamixer  
```  
  
## ５．トラブルシューティング  
  
　bluetoothスピーカが自動でオフになったり、  
手動でオフにした場合、再度パワーをオンにしてもうまくつながらない機種があります。  
以下のことをやればつながります。  
ただし、そういう機種はストレスの元ですのでお勧めしません。  
  
bluetoothスピーカの名称 ：　SR1323 （ここでの例）  
Bluetooth Device Address　：　XX:XX:XX:XX:XX:XX  
  
SSHでRaspberry Pi にアクセスし、以下のコマンドを入力します。  
-- (マイナスが２つ)  
  
```  
$ sudo bluetoothctl -- paired-devices  
Device XX:XX:XX:XX:XX:XX SR1323  
$ sudo bluetoothctl -- connect XX:XX:XX:XX:XX:XX  
```  
  
Connection successful と表示されたら成功です。  
  
それでもうまくいかない場合は、removeして再度やりなおすといいかもしれません。  
  
  
６．動作確認機種  
  
以下は私が動作確認をした機種です。  
  
```  
1) ダイソー SR9910 550円　自動再接続 OK  
  
2) ダイソー SR1323 770円　自動再接続 BAD 　(お勧めしません)  
  
電源をONにしたときに毎回以下のコマンドが必要。  
  
$ sudo bluetoothctl -- connect XX:XX:XX:XX:XX:XX  
  
3) TDK TW234　自動再接続 OK  
  
ずいぶん以前にCostcoで購入し、しまってあったものです。  
  
4) LEVIN Bluetoothイヤホン Maraton　自動再接続 OK  
  
amazonで１年位前に購入したもの。  
  
5) Anker SoundCore　自動再接続 OK  
  
6) Anker SoundCore2　自動再接続 OK  
  
7) ダイソー LBS 550円　自動再接続 OK  
```  
  
７．その他  
  
　bluetoothでのペアリングはスマホ等にくらべるとちょっと面倒ですが、  
それがうまくいけば、あとは簡単だと思います。  
  
　では、rfriendsで楽しいラジオライフを！  
  
  
以上  
