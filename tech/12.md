rfriendsの録音データを定期的にWindowsにバックアップ  
  
2025/05/04  
  
## １．rfriendsのバックアップ設定  
  
設定 - パラメータ - 編集  
ctrl-fで、[backup]、を検索  
  
以下は14日以前のファイルは  
/home/rpi/smbdir/usr2_bk/  
に強制的に移動するという設定です。  
smbdir以下にusr2_bkというディレクトリを作成してください。  
```  
[backup]  
;　usrdirのファイルで指定日付以前のファイルをcopy/move/deleteします。  
;  日付判定はファイルの日付で行います。  
;　バックアップ処理およびデイリー処理のcleanup時に実行します。  
;  
rfbackup = 14  
rfbackup_mode = "movef"  
rfbackup_dir = "/home/rpi/smbdir/usr2_bk/"  
```  
  
## ２．録音データをwindowsにバックアップ  

### 2.1 rfget.zipのダウンロード  

以下のリンクよりrfget.zipをダウンロードして解凍しrfgetディレクトリ毎バックアップを行う場所にコピーしてください。   
[rfget.zip](rfget.zip)  
  
rfgetディレクトリには以下のファイルがあると思います。  
```  
readme.txt
rfdir
rfget.bat
rfget.txt
rfget_del.txt
WinSCP-6.5-Setup.exe
WinSCP.com
WinSCP.exe
```  
  
### 2.2 rfget.batの編集  
  
1) 最低、USER,PASSWD,HOSTを設定します。  
```  
SET USER=rpi  
SET PASSWD=rfriends  
SET HOST=192.168.1.74  
```  
2) 他は環境を変えたいときに変更してください。  
```  
SET REMOTE=/home/rpi/smbdir/usr2_bk/  
SET LOCAL=rfdir/  
SET HOSTDEL=no  
```  
・ホストのバックアップ元は  
SET REMOTE=/home/rpi/smbdir/usr2_bk/  
を設定してください。  
  
・バックアップデータは、実行ディレクトリの  
SET LOCAL=rfdir/  
に保存されます。  
  
・バックアップが成功したとき、そのファイルを削除したい場合は、  
SET HOSTDEL=yes  
に変更してください。  
これは設定が問題ないことを確認したのちに変更してください。  
  
  
### 2.3 rfget.batの実行  
  
rfget.batをダブルクリックすると、コマンドプロンプトが開き  
winscpが実行されます。  
  
  
### 2.4 ホストの信頼チェック  
  
初回は下記のようにホストを信頼するかどうか聞かれるので  
(A)cceptのAを入力して下さい。  
```  
If you trust this host, select Accept to add the key to WinSCP's cache and carry on connecting.  
If you want to carry on connecting just once, without adding the key to the cache, select Connect Once.  
If you do not trust this host, select Cancel to abandon the connection.  
In scripting, you should use a -hostkey switch to configure the expected host key.  
(A)ccept, Connect (O)nce, Ca(n)cel, (C)opy Key, (P)aste key:A  
```  
この処理は初回のみです。  
  
  
### 2.5 ログイン  
  
続いて、Username、Passwordを入力してください。  
```  
Authenticating...  
Username: rpi  
Password: rfriends  
```  
成功すると、以下のようなメッセージが出力されます。  
```
Authenticated.  
Starting the session...  
Session started.  
Active session: [1] XXX.XXX.XXX.XXX  
```    
  
### 2.6 バックアップ処理  
  
続いて、バックアップ処理が開始されます。  
  
実行経過が画面に出力されていきます。  
途中でやめたいときは、ctrl-cを入力してください。  
  
  
## ３．Windowsへのバックアップ処理の自動化  
  
これを自動化するためには以下の手順で行ってください。 
  
1) "task"で検索し、タスクスケジューラを起動します。  
![task](https://github.com/user-attachments/assets/c128e6a7-f214-4e0e-a6b2-65a7d9df5b3f)
  
2) タスクスケジューラに、rfget.bat、を登録し、  
トリガーを毎日何時といった風に設定します。  
![task2](https://github.com/user-attachments/assets/9152fde6-5433-4257-938b-7574e8acf6be)
  
詳細なやり方は、「windows タスクスケジューラ」で検索してください。  
  
  
## ４．その他  
  
無理に自動化しなくても、気が向いたときに手動で実行するというのもありだと思います。  
まだ試験途中なので、これでうまくいったとか、いかないとかの報告があると助かります。  
  
なお、お約束ですが、これの実行に関しては自己責任でお願いします。 
  
  
以上  

