# xserver VPSにrfriends3をインストールする

## 現在、書きかけです。  
  
Xserver VPS にrfriends3をインストールします。  

  
> [!note]
> [xserver VPS（無料）を契約する](15.md)の続きです。  
> サーバーは、Ubuntu 24.04、とします。  
> ほかの場合は、[Linux/BSD版rfriends3でラジオ録音](https://rfriends.github.io/rfriends/distro/rfriends3_core.html)を参照してください。  
  
  
2025/08/06 new  
2025/08/06 mod  
  
  
## １．シリアルコンソール
    
詳しくは、 [xserver VPS（無料）を契約する](15.md)を参照。  
  
1) xserver VPSにログインしてください。  
  
[ログイン](https://secure.xserver.ne.jp/xapanel/login/xvps/)  
   
2) VPS管理  をクリックしてください。  
  
3) コンソール - シリアルコンソール  をクリックしてください。  
  
4) root,設定したパスワードでログインしてください。  
  
  


  
  
## ２．rfriends3のインストール
  
詳細は、
[Linux/BSD版rfriends3でラジオ録音](https://rfriends.github.io/rfriends/distro/rfriends3_core.html)  

1) システムを最新にする。  
```  
$ sudo apt update
$ sudo apt upgrade    
```
  
2) 実行ユーザを登録する。  
```  
# useradd -m -G sudo ユーザ名
# passwd ユーザ名
# chsh -s /bin/bash ユーザ名
# exit  
```

3) 実行ユーザでログインして、rfriendsをインストールする。  
```
$ cd ~/
$ rm -rf rfriends3_core   
$ git clone https://github.com/rfriends/rfriends3_core.git  
$ cd rfriends3_core  
$ sh install_XXXXX.sh
```
  
> [!caution]
> chromiumのインストールに時間がかかるようです。
  
4) システムを再起動する。  
     
```
$ sudo reboot
```


  
## ３．rfriends3を実行する。  
  
1) cuiモードの実行。
シリアルコンソールを開き、以下を入力する。  
  
```  
$ cd  
$ cd rfriends3  
$ sh rfriends3.sh    
```

以下のような画面が表示されたら成功です。
  

  
2) guiモードの実行。
  
PC等でブラウザを開き
　　
```  
https://IPアドレス:8000    
```
と入力し、以下のような画面が表示されたら成功です。

## ４．パケットフィルタ設定を行う。  
  
グローバルＩＰアドレスを確認する。  

Webブラウザで下記にアクセスし、グローバルＩＰアドレスを確認する。 
  
> [!caution]
>  下記にアクセスすることが不安な方は別の方法で、グローバルＩＰアドレスを確認してください。
> nslookup,dig等  
  
  
https://www.cman.jp/network/support/go_access.cgi
  
パケットフィルタ設定を行う。  

自分以外からのアクセスをさせないための設定です。
設定するのは以下の3つです。  

・ssh(22)  
・http(8000)  
・samba(445)  
  
再度、rfriends3が実行できることを確認してください。  
もし、アクセスできなければ、グローバルＩＰアドレスが間違っているか、パケットフィルタ設定が間違っています。 


また、できれば、他からはアクセスできないことも確認してください。  

## ５．SSHアクセスを行う。  
  
標準のシリアルコンソールでほほ不足はありませんが、sshでアクセスしたい場合の設定です。  

サーバーのインストール時にSSH Key（秘密鍵）をダウンロードしたと思います。
公開鍵は/root/.ssh/authorizedkeyに設定されています。  

この公開鍵を実行ユーザにもコピーしましょう。  
```  
$ cd
$ mkdir .ssh
$ cd .ssh  
$ sudo cp /root/.ssh/authorized_keys .
$ sudo chown ユーザ名:ユーザ名 authorized_keys
$ ip a
```

SSHアクセスを行う。  

teraterm,rlogin.putty,windows terminal等のsshクライアントでアクセスしてみてください。  

Windows Terminalの接続例  
ssh ユーザ名@IPアドレス　-i 秘密鍵  
  
![win](https://github.com/user-attachments/assets/5fbaaa9b-f330-42cd-ba8d-cff6a745e53d)  
  

    
## ７．今後の予定  
  
契約したサーバーにrfriendsをインストールする。  
を執筆予定です。  
  
  
以上  
