# xserver VPSにrfriends3をインストールする

  
Xserver VPS にrfriends3をインストールします。  

  
> [!note]
> [xserver VPS（無料）を契約する](15.md)の続きです。  
> サーバーは、Ubuntu 24.04、とします。  
> ほかの場合は、[Linux/BSD版rfriends3でラジオ録音](https://rfriends.github.io/rfriends/distro/rfriends3_core.html)を参照してください。  
  
  
2025/08/06 new  
2025/08/06 mod  
  
  
## １．シリアルコンソール
    
詳しくは、 [xserver VPS（無料）を契約する](15.md)を参照。  
  
1) xserver VPSにログインしてください。  
  
[ログイン](https://secure.xserver.ne.jp/xapanel/login/xvps/)  
   
2) VPS管理  をクリックしてください。  
  
3) コンソール - シリアルコンソール  をクリックしてください。  
  
4) root,設定したパスワードでログインしてください。  
  

![u01](https://github.com/user-attachments/assets/5f298c90-39ec-4f20-b8fe-2cc0f7f59fb3)



  
  
## ２．実行ユーザを追加する。  
  

1) システムを最新にする。  
```  
$ sudo apt update
$ sudo apt upgrade    
```
  
2) 実行ユーザを追加する。  
```  
# useradd -m -G sudo ユーザ名
# passwd ユーザ名
# chsh -s /bin/bash ユーザ名
```

3) ログアウトする。  
  
```
# exit    
```  
    
##  ３．rfriends3のインストール
  
1) 実行ユーザでログインして、rfriendsをインストールする。  
```
$ cd ~/
$ rm -rf rfriends3_core   
$ git clone https://github.com/rfriends/rfriends3_core.git  
$ cd rfriends3_core  
$ sh install_ubuntu.sh
```
  
> [!caution]
> 現在、chromiumのインストールに時間がかかるようです。
  
2) システムを再起動する。  
     
```
$ sudo reboot
```


  
## ４．rfriends3を実行する。  
  
1) cuiモードの実行。
シリアルコンソールを開き、以下を入力する。  
  
```  
$ cd  
$ cd rfriends3  
$ sh rfriends3.sh    
```

以下のような画面が表示されたら成功です。
  
![u11](https://github.com/user-attachments/assets/7992efa6-aefa-466d-b85c-c21b4e27a8e7)


  
2) guiモードの実行。
  
PC等でブラウザを開き
　　
```  
https://IPアドレス:8000    
```
と入力し、以下のような画面が表示されたら成功です。  

![u10](https://github.com/user-attachments/assets/29f64449-0ae8-4aca-84a8-0d794b1a92c1)

## ５．パケットフィルタ設定を行う。  

> [!caution]  
>  自分以外からのアクセスをさせないための設定で必須です。   
  
1) グローバルＩＰアドレスを確認する。  

Webブラウザで下記にアクセスし、グローバルＩＰアドレスを確認する。 
  
> [!caution]
>  下記にアクセスすることが不安な方は別の方法で、グローバルＩＰアドレスを確認してください。
> nslookup,dig等  
  
  
https://www.cman.jp/network/support/go_access.cgi
  
2) パケットフィルタ設定を行う。
   
 
  
![u02](https://github.com/user-attachments/assets/13d3284c-c033-47cc-b9fe-1f7b7d06b0a3)


設定するのは以下の3つです。  
  
・ssh(22)  
・http(8000)  
・samba(445)  

以下の要領で３つを追加する。  
  
![u07](https://github.com/user-attachments/assets/a2370d28-3e1a-4062-9a1d-e605e9f941e8)
  
3つを追加した結果  
  
![u09](https://github.com/user-attachments/assets/191f1fde-69c0-48f4-9220-d7680e6f64bb)
  
3) 再度、rfriends3が実行できることを確認してください。  
  
もし、アクセスできなければ、グローバルＩＰアドレスが間違っているか、パケットフィルタ設定が間違っています。 
  
また、できれば、他からはアクセスできないことも確認してください。  
  
## ６．SSHアクセスを行う。  
  
標準のシリアルコンソールでほほ不足はありませんが、sshでアクセスしたい場合の設定です。  

1) 公開鍵の設定  
    
サーバーのインストール時にSSH Key（秘密鍵）をダウンロードしたと思います。
公開鍵は/root/.ssh/authorizedkeyに設定されています。  
  
この公開鍵を実行ユーザにもコピーしましょう。  
```  
$ cd
$ mkdir .ssh
$ cd .ssh  
$ sudo cp /root/.ssh/authorized_keys .
$ sudo chown ユーザ名:ユーザ名 authorized_keys
```
  
2) このサーバのIPアドレス
    
このサーバのIPアドレスを確認します。    
  
```  
$ hostname -I
XXX.XXX.XXX.XXX  
```
  
3) SSHアクセスを行う。  
  
teraterm,rlogin.putty,windows terminal等のsshクライアントでアクセスしてみてください。  
  
Windows Terminalの接続例  
  
ssh ユーザ名@IPアドレス　-i 秘密鍵  
  
![win](https://github.com/user-attachments/assets/5fbaaa9b-f330-42cd-ba8d-cff6a745e53d)  
  
  
以上  
